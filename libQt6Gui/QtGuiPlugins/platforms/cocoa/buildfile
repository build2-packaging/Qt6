# Note: If anything in this file seems underdocumented it is probably covered
#       in libQt6Core/QtCore/buildfile.
#
include ../../../QtGui/

# Objective-C++ source files to be compiled (some source files are included).
#
src = main                              \
      qcocoaaccessibility               \
      qcocoaaccessibilityelement        \
      qcocoaapplication                 \
      qcocoaapplicationdelegate         \
      qcocoabackingstore                \
      qcocoaclipboard                   \
      qcocoacolordialoghelper           \
      qcocoacursor                      \
      qcocoadrag                        \
      qcocoaeventdispatcher             \
      qcocoafiledialoghelper            \
      qcocoafontdialoghelper            \
      qcocoahelpers                     \
      qcocoainputcontext                \
      qcocoaintegration                 \
      qcocoaintrospection               \
      qcocoamenu                        \
      qcocoamenubar                     \
      qcocoamenuitem                    \
      qcocoamenuloader                  \
      qcocoamessagedialog               \
      qcocoamimetypes                   \
      qcocoanativeinterface             \
      qcocoansmenu                      \
      qcocoascreen                      \
      qcocoaservices                    \
      qcocoasystemtrayicon              \
      qcocoatheme                       \
      qcocoawindow                      \
      qcocoawindowmanager               \
      qiosurfacegraphicsbuffer          \
      qmacclipboard                     \
      qmultitouch_mac                   \
      qnsview                           \
      qnswindow                         \
      qnswindowdelegate

# C++ source files to be compiled.
#
src_cxx = qcocoasessionmanager

# Objective-C++ headers to be moc'd and the output compiled.
#
moc_hdr = qcocoaeventdispatcher \
          qcocoainputcontext    \
          qcocoanativeinterface

# Objective-C++ headers to be moc'd and the output included.
#
moc_hdr_adhoc = qcocoabackingstore      \
                qcocoaclipboard         \
                qcocoaintegration       \
                qcocoamenubar           \
                qcocoawindow

# Objective-C++ source files to be moc'd and the output included.
#
moc_src_adhoc = main \
                qcocoascreen

# C++ headers and compiled Objective-C++ and C++ source files.
#
../lib{qcocoa}: ../../../mkspecs/hxx{**} hxx{*} mm{$src} cxx{$src_cxx}

# Included Objective-C++ source files.
#
../lib{qcocoa}: mm{* -{$src}}: include = adhoc

# The "metadata library": its purpose is to make sure all the imported
# libraries are resolved for the ad hoc moc rules.
#
# Note: use a rule hint to resolve ambiguity between C and C++ library.
#
[rule_hint=cxx] libul{Qt6PluginsCocoaMeta}: \
  ../../../QtGui/lib{Qt6Gui Qt6GuiPrivate}

# Plugin metadata file.
#
../lib{qcocoa}: file{cocoa.json}: include = adhoc

# Dependencies involving moc-generated C++ source files.
#

# The dependencies of moc-generated C++ source files on the headers they were
# generated from (for example, `moc foo.h` produces moc_foo.cpp).
#
for s: hxx{$moc_hdr $moc_hdr_adhoc}
  cxx{moc_$name($s)}: $s libul{Qt6PluginsCocoaMeta}

# The dependencies of lib{qcocoa} on C++ source files (moc_foo.cpp) generated
# by moc from headers. Note that some of these C++ source files are compiled
# and some are included.
#
for s: hxx{$moc_hdr}
  ../lib{qcocoa}: cxx{moc_$name($s)}
for s: hxx{$moc_hdr_adhoc}
  ../lib{qcocoa}: cxx{moc_$name($s)}: include = adhoc

# Dependencies involving lib{qcocoa}, moc-generated C++ source files
# (foo.moc), and the Objective-C++ source files the .moc's were generated from
# (for example, `moc foo.mm` produces foo.moc).
#
for s: mm{$moc_src_adhoc}
{
  n = $name($s)
  moc{$n}: $s libul{Qt6PluginsCocoaMeta}
  ../lib{qcocoa}: moc{$n}: include = adhoc
}

# Dependencies involving source files generated by rcc from Qt resource
# collection files and their associated resources.
#
../lib{qcocoa}:           cxx{qrc_qcocoaresources}
cxx{qrc_qcocoaresources}: qrc{qcocoaresources} images/file{*.png}

../lib{qcocoa}: libul{Qt6PluginsCocoaMeta}

# Build options.
#
cxx.poptions =+ "-I$out_base" "-I$src_base"

# Define macros.
#
cxx.poptions += $plugin_macros

objs{$src}: cxx.poptions += $so_macros

../lib{qcocoa}: cxx.libs += -framework AppKit                   \
                            -framework Carbon                   \
                            -framework CoreServices             \
                            -framework CoreVideo                \
                            -framework IOKit                    \
                            -framework IOSurface                \
                            -framework Metal                    \
                            -framework UniformTypeIdentifiers   \
                            -framework QuartzCore

# Installation.
#
../lib{qcocoa}: install = lib/qt6/plugins/platforms/
