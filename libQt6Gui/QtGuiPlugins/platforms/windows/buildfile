# Note: If anything in this file seems underdocumented it is probably covered
#       in libQt6Core/QtCore/buildfile.
#
include ../../../QtGui/

src = main                                              \
      qwin10helpers                                     \
      qwindowsapplication                               \
      qwindowsbackingstore                              \
      qwindowsclipboard                                 \
      qwindowscontext                                   \
      qwindowscursor                                    \
      qwindowsdialoghelpers                             \
      qwindowsdrag                                      \
      qwindowsdropdataobject                            \
      qwindowsgdiintegration                            \
      qwindowsgdinativeinterface                        \
      qwindowsiconengine                                \
      qwindowsinputcontext                              \
      qwindowsintegration                               \
      qwindowsinternalmimedata                          \
      qwindowskeymapper                                 \
      qwindowsmenu                                      \
      qwindowsmimeregistry                              \
      qwindowsmousehandler                              \
      qwindowsnativeinterface                           \
      qwindowsole                                       \
      qwindowsopengltester                              \
      qwindowspointerhandler                            \
      qwindowsscreen                                    \
      qwindowsservices                                  \
      qwindowssessionmanager                            \
      qwindowssystemtrayicon                            \
      qwindowstabletsupport                             \
      qwindowstheme                                     \
      qwindowswindow                                    \
      uiautomation/qwindowsuiaaccessibility             \
      uiautomation/qwindowsuiabaseprovider              \
      uiautomation/qwindowsuiaexpandcollapseprovider    \
      uiautomation/qwindowsuiagriditemprovider          \
      uiautomation/qwindowsuiagridprovider              \
      uiautomation/qwindowsuiainvokeprovider            \
      uiautomation/qwindowsuiamainprovider              \
      uiautomation/qwindowsuiaprovidercache             \
      uiautomation/qwindowsuiarangevalueprovider        \
      uiautomation/qwindowsuiaselectionitemprovider     \
      uiautomation/qwindowsuiaselectionprovider         \
      uiautomation/qwindowsuiatableitemprovider         \
      uiautomation/qwindowsuiatableprovider             \
      uiautomation/qwindowsuiatextprovider              \
      uiautomation/qwindowsuiatextrangeprovider         \
      uiautomation/qwindowsuiatoggleprovider            \
      uiautomation/qwindowsuiautils                     \
      uiautomation/qwindowsuiavalueprovider             \
      uiautomation/qwindowsuiawindowprovider

# C++ headers to be moc'd and the output compiled.
#
moc_hdr = qwindowsgdinativeinterface            \
	  qwindowsinputcontext                  \
	  qwindowsmenu                          \
	  qwindowsnativeinterface               \
	  uiautomation/qwindowsuiabaseprovider  \
	  uiautomation/qwindowsuiamainprovider  \
	  uiautomation/qwindowsuiaprovidercache

# C++ source files to be moc'd and the output included.
#
moc_src_adhoc = main \
                qwindowsdialoghelpers

# C++ headers and compiled C++ source files.
#
../lib{qwindows}: ../../../mkspecs/hxx{**}                              \
                  ../../../3rdparty/wintab/hxx{*}                       \
                           hxx{**} cxx{$src}

# The "metadata library": its purpose is to make sure all the imported
# libraries are resolved for the ad hoc moc rules below.
#
# Note: use a rule hint to resolve ambiguity between C and C++ library.
#
[rule_hint=cxx] libul{Qt6PluginsWindowsMeta}: \
  ../../../QtGui/lib{Qt6Gui Qt6GuiPrivate}

# Plugin metadata file.
#
../lib{qwindows}: file{windows.json}: include = adhoc

# Dependencies involving moc-generated C++ source files.
#

# The dependencies of moc-generated C++ source files on the headers they were
# generated from (for example, `moc foo.h` produces moc_foo.cpp).
#
for s: hxx{$moc_hdr}
{
  n = $name($s)
  cxx{moc_$n}: $s libul{Qt6PluginsWindowsMeta}
  ../lib{qwindows}: cxx{moc_$n}
}

# Dependencies involving lib{qwindows}, moc-generated C++ source files
# (foo.moc), and the C++ source files the .moc's were generated from (for
# example, `moc foo.cpp` produces foo.moc).
#
for s: cxx{$moc_src_adhoc}
{
  n = $name($s)
  moc{$n}: $s libul{Qt6PluginsWindowsMeta}
  ../lib{qwindows}: moc{$n}: include = adhoc
}

# Dependencies involving source files generated by rcc from Qt resource
# collection files and the associated resources.
#
../lib{qwindows}:          cxx{qrc_cursors qrc_openglblacklists}
cxx{qrc_cursors}:          qrc{cursors} images/file{*.png}
cxx{qrc_openglblacklists}: qrc{openglblacklists} \
                           openglblacklists/file{default.json}

../lib{qwindows}: libul{Qt6PluginsWindowsMeta}

# Build options.
#
cxx.poptions =+ "-I$out_base" "-I$src_base"                             \
                "-I$src_base/uiautomation"                              \
                "-I$src_root/3rdparty/wintab"

# Define macros.
#
# Note that this is the only platform plugin that defines
# QT_NO_CAST_FROM_ASCII.
#
cxx.poptions += $plugin_macros -DQT_NO_CAST_FROM_ASCII

objs{$src}: cxx.poptions += $so_macros

switch $cxx.target.class, $cxx.target.system
{
  case 'windows', 'mingw32'
  {
    ../lib{qwindows}: cxx.libs += -lcomdlg32            \
                                  -ld3d9                \
                                  -ldwmapi              \
                                  -lgdi32               \
                                  -limm32               \
                                  -lole32               \
                                  -loleaut32            \
                                  -lruntimeobject       \
                                  -lshcore              \
                                  -lsetupapi            \
                                  -lshlwapi             \
                                  -luuid                \
                                  -lwinmm               \
                                  -lwinspool            \
                                  -lwtsapi32
  }
  case 'windows'
  {
    ../lib{qwindows}: cxx.libs += comdlg32.lib          \
                                  d3d9.lib              \
                                  dwmapi.lib            \
                                  gdi32.lib             \
                                  imm32.lib             \
                                  ole32.lib             \
                                  oleaut32.lib          \
                                  runtimeobject.lib     \
                                  shcore.lib            \
                                  setupapi.lib          \
                                  shlwapi.lib           \
                                  winmm.lib             \
                                  winspool.lib          \
                                  wtsapi32.lib
  }
}

# Installation.
#
../lib{qwindows}: install = lib/qt6/plugins/platforms/
